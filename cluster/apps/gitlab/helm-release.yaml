---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: gitlab
  namespace: gitlab
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://charts.gitlab.io
      chart: gitlab
      version: 5.5.0
      sourceRef:
        kind: HelmRepository
        name: gitlab-charts
        namespace: flux-system
      interval: 5m
  values:
    global:
      hosts:
        domain: imake.software
      ingress:
        configureCertmanager: false
        class: nginx-external
        tls:
          enabled: true
          secretName: acme-crt-secret-imake-software
      initialRootPassword:
        secret: gitlab-initial-root-password
        key: password
      time_zone: America/Chicago
      email:
        from: "no-reply@gitlab.imake.software"
        display_name: GitLab
        reply_to: ""
        subject_suffix: ""
        smime:
          enabled: false
          secretName: ""
          keyName: "tls.key"
          certName: "tls.crt"
      minio:
        enabled: true
      #appConfig:
      #  object_store:
      #    enabled: true
      #    connection:
      #      secret: gitlab-bucket-storage
      #      key: connection
    gitlab:
      gitaly:
        persistence:
          volumeName: gitlab-gitaly-ha
          storageClass: ceph-block
          size: 75Gi
    postgresql:
      persistence:
        volumeName: gitlab-postgresql-ha
        storageClass: ceph-block
        size: 8Gi
    #minio:
    #  replicas: 1
    #  persistence:
    #    enabled: true
    #    volumeName: gitlab-minio-ha
    #    storageClass: ceph-block
    #    size: 10Gi
    redis:
      master:
        persistence:
          volumeName: gitlab-redis-ha
          storageClass: ceph-block
          size: 5Gi
    certmanager:
      installCRDs: false
      install: false
      rbac:
        create: false
    nginx-ingress:
      enabled: false

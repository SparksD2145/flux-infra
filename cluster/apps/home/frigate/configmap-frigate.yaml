---
apiVersion: v1
kind: ConfigMap
metadata:
  name: frigate-configmap
  namespace: home
data:
  config.yml: |
    auth:
      enabled: false

    mqtt:
      enabled: false
      # host: emqx-listeners.default.svc
      # topic_prefix: frigate
      # user: mqtt
      # password: '{FRIGATE_MQTT_PASSWORD}'

    database:
      path: /config/frigate.db

    detectors:
      coral:
        type: edgetpu
        device: usb

    birdseye:
      enabled: true
      # restream: true
      mode: continuous

    ffmpeg:
      hwaccel_args: auto
      output_args:
        record: preset-record-generic

    audio:
      enabled: false

    # objects:
    #   track:
    #     - person
    #     - dog
    #     - cat
    #   filters:
    #     person:
    #       min_area: 3000
    #       max_area: 100000
    #       threshold: 0.75
    #     dog:
    #       min_area: 1000
    #       max_area: 10000
    #       threshold: 0.75
    #     cat:
    #       min_area: 1000
    #       max_area: 10000
    #       threshold: 0.75

    record:
      enabled: false
      retain:
        days: 3
        mode: all
      alerts:
        retain:
          days: 3
          mode: active_objects
      detections:
        retain:
          days: 14
          mode: active_objects

    review:
      alerts:
        labels:
          - person
          - dog
          - car
      detections:
        labels:
          - person
          - dog
          - cat

    snapshots:
      enabled: true
      timestamp: false
      bounding_box: true
      crop: false
      retain:
        default: 7

    go2rtc:
      streams:
        dome_camera_1_detect:
          - rtsp://dome-camera-1.sparks.codes/ch0_0.h264
        dome_camera_1_record:
          - rtsp://dome-camera-1.sparks.codes/ch0_0.h264
        server_room_detect:
          - rtsp://dome-camera-2.sparks.codes/ch0_0.h264
        server_room_record:
          - rtsp://dome-camera-2.sparks.codes/ch0_0.h264

    cameras:
      server_room:
        ffmpeg:
          inputs:
            - path: rtsp://127.0.0.1:8554/server_room_detect
              input_args: preset-rtsp-restream
              roles:
                - detect
            - path: rtsp://127.0.0.1:8554/server_room_record
              input_args: preset-rtsp-restream
              roles:
                - record
        detect:
          fps: 5
        live:
          stream_name: server_room_record

      dome_camera_1:
        ffmpeg:
          inputs:
            - path: rtsp://127.0.0.1:8554/dome_camera_1_detect
              input_args: preset-rtsp-restream
              roles:
                - detect
            - path: rtsp://127.0.0.1:8554/dome_camera_1_record
              input_args: preset-rtsp-restream
              roles:
                - record
        detect:
          fps: 5
        live:
          stream_name: dome_camera_1_record
